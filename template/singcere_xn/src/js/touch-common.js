var supporttouch="ontouchend"in document;var platform=navigator.platform;var ua=navigator.userAgent;var ios=/iPhone|iPad|iPod/.test(platform)&&ua.indexOf("AppleWebKit")>-1;var andriod=ua.indexOf("Android")>-1;(function(y,h,e,C){var j="virtualMouseBindings",N="virtualTouchID",a="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),p="clientX clientY pageX pageY screenX screenY".split(" "),m=y.event.mouseHooks?y.event.mouseHooks.props:[],A=y.event.props.concat(m),n={},f=0,t=0,u=0,w=false,J=[],H=false,Q=false,s="addEventListener"in e,r=y(e),F=1,O=0,M;y.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500};function q(i){while(i&&typeof i.originalEvent!=="undefined"){i=i.originalEvent}return i}function g(S,U){var ac=S.type,ad,ab,V,T,Z,Y,X,W,aa;S=y.Event(S);S.type=U;ad=S.originalEvent;ab=y.event.props;if(ac.search(/^(mouse|click)/)>-1){ab=A}if(ad){for(X=ab.length,T;X;){T=ab[--X];S[T]=ad[T]}}if(ac.search(/mouse(down|up)|click/)>-1&&!S.which){S.which=1}if(ac.search(/^touch/)!==-1){V=q(ad);ac=V.touches;Z=V.changedTouches;Y=(ac&&ac.length)?ac[0]:((Z&&Z.length)?Z[0]:C);if(Y){for(W=0,aa=p.length;W<aa;W++){T=p[W];S[T]=Y[T]}}}return S}function P(U){var S={},i,T;while(U){i=y.data(U,j);for(T in i){if(i[T]){S[T]=S.hasVirtualBinding=true}}U=U.parentNode}return S}function o(S,T){var i;while(S){i=y.data(S,j);if(i&&(!T||i[T])){return S}S=S.parentNode}return null}function I(){Q=false}function D(){Q=true}function R(){O=0;J.length=0;H=false;D()}function x(){I()}function v(){B();f=setTimeout(function(){f=0;R()},y.vmouse.resetTimerDuration)}function B(){if(f){clearTimeout(f);f=0}}function z(T,U,i){var S;if((i&&i[T])||(!i&&o(U.target,T))){S=g(U,T);y(U.target).trigger(S)}return S}function E(S){var T=y.data(S.target,N);if(!H&&(!O||O!==T)){var i=z("v"+S.type,S);if(i){if(i.isDefaultPrevented()){S.preventDefault()}if(i.isPropagationStopped()){S.stopPropagation()}if(i.isImmediatePropagationStopped()){S.stopImmediatePropagation()}}}}function b(T){var V=q(T).touches,U,i;if(V&&V.length===1){U=T.target;i=P(U);if(i.hasVirtualBinding){O=F++;y.data(U,N,O);B();x();w=false;var S=q(T).touches[0];t=S.pageX;u=S.pageY;z("vmouseover",T,i);z("vmousedown",T,i)}}}function d(i){if(Q){return}if(!w){z("vmousecancel",i,P(i.target))}w=true;v()}function c(V){if(Q){return}var T=q(V).touches[0],S=w,U=y.vmouse.moveDistanceThreshold,i=P(V.target);w=w||(Math.abs(T.pageX-t)>U||Math.abs(T.pageY-u)>U);if(w&&!S){z("vmousecancel",V,i)}z("vmousemove",V,i);v()}function G(U){if(Q){return}D();var i=P(U.target),T;z("vmouseup",U,i);if(!w){var S=z("vclick",U,i);if(S&&S.isDefaultPrevented()){T=q(U).changedTouches[0];J.push({touchID:O,x:T.clientX,y:T.clientY});H=true}}z("vmouseout",U,i);w=false;v()}function k(S){var T=y.data(S,j),i;if(T){for(i in T){if(T[i]){return true}}}return false}function L(){}function l(S){var i=S.substr(1);return{setup:function(U,T){if(!k(this)){y.data(this,j,{})}var V=y.data(this,j);V[S]=true;n[S]=(n[S]||0)+1;if(n[S]===1){r.bind(i,E)}y(this).bind(i,L);if(s){n.touchstart=(n.touchstart||0)+1;if(n.touchstart===1){r.bind("touchstart",b).bind("touchend",G).bind("touchmove",c).bind("scroll",d)}}},teardown:function(U,T){--n[S];if(!n[S]){r.unbind(i,E)}if(s){--n.touchstart;if(!n.touchstart){r.unbind("touchstart",b).unbind("touchmove",c).unbind("touchend",G).unbind("scroll",d)}}var V=y(this),W=y.data(this,j);if(W){W[S]=false}V.unbind(i,L);if(!k(this)){V.removeData(j)}}}}for(var K=0;K<a.length;K++){y.event.special[a[K]]=l(a[K])}if(s){e.addEventListener("click",function(X){var U=J.length,S=X.target,Z,Y,aa,V,T,W;if(U){Z=X.clientX;Y=X.clientY;M=y.vmouse.clickDistanceThreshold;aa=S;while(aa){for(V=0;V<U;V++){T=J[V];W=0;if((aa===S&&Math.abs(T.x-Z)<M&&Math.abs(T.y-Y)<M)||y.data(aa,N)===T.touchID){X.preventDefault();X.stopPropagation();return}}aa=aa.parentNode}}},true)}})(jQuery,window,document);(function(c,a,d){function b(h,f,e){var g=e.type;e.type=f;c.event.handle.call(h,e);e.type=g}c.event.special.tap={setup:function(){var e=this;var f=c(e);f.on("vmousedown",function(k){if(k.which&&k.which!==1){return false}var l=k.target;var i=k.originalEvent;var m;function g(){clearTimeout(m)}function h(){g();f.off("vclick",j).off("vmouseup",g);c(document).off("vmousecancel",h)}function j(n){h();if(l===n.target){b(e,"tap",n)}return false}f.on("vmouseup",g).on("vclick",j);c(document).on("touchcancel",h);m=setTimeout(function(){b(e,"taphold",c.Event("taphold",{target:l}))},750);return false})}};c.each(("tap").split(" "),function(f,e){c.fn[e]=function(g){return this.on(e,g)}})})(jQuery,this);var page={converthtml:function(){var b=$("div.pg .prev").prop("href");var d=$("div.pg .nxt").prop("href");var e=$("div.pg label span").text().replace(/[^\d]/g,"")||0;var g=$("div.pg input").val()||1;if(!e){b=$("div.pg .pgb a").prop("href")}var f=nextpagehref="";if(b==undefined){f='javascript:;" class="grey'}else{f=b}if(d==undefined){nextpagehref='javascript:;" class="grey'}else{nextpagehref=d}var a="";if(e){a+='<a id="select_a" style="position:relative;">';a+='<select id="dumppage" style="position:absolute;left:0;top:0;height:48px;opacity:0;width:100%;">';for(var c=1;c<=e;c++){a+='<option value="'+c+'" '+(c==g?"selected":"")+">第"+c+"页</option>"}a+="</select>";a+="<span>第"+g+"页</span>"}$("div.pg").removeClass("pg").addClass("page").html('<a href="'+f+'">上一页</a>'+a+'<a href="'+nextpagehref+'">下一页</a>');$("#dumppage").on("change",function(){var h=(b||d);window.location.href=h.replace(/page=\d+/,"page="+$(this).val())})},};var img={init:function(a){var b=this.errorhandle;$("img").on("load",function(){var c=$(this);if(c.width()<5&&c.height()<10&&c.css("display")!="none"){return b(c,a)}if(c.width()>window.innerWidth){c.css("width",window.innerWidth)}c.parent().find(".loading").remove();c.parent().find(".error_text").remove()}).on("error",function(){var c=$(this);b(c,a)})},errorhandle:function(d,c){if(d.attr("noerror")=="true"){return}d.css("visibility","hidden");d.css("display","none");var b=d.parent();b.find(".loading").remove();b.append('<div class="loading" style="background:url('+"template/singcere_xn/src/img/imageloading.gif) no-repeat center center;width:"+b.width()+"px;height:"+b.height()+'px"></div>');var a=parseInt(d.attr("load"))||0;if(a<3){d.attr("src",d.attr("zsrc"));d.attr("load",++a);return false}if(c){var b=d.parent();b.find(".loading").remove();b.append('<div class="error_text">点击重新加载</div>');b.find(".error_text").one("click",function(){d.attr("load",0).find(".error_text").remove();b.append('<div class="loading" style="background:url('+"template/singcere_xn/src/img/imageloading.gif) no-repeat center center;width:"+b.width()+"px;height:"+b.height()+'px"></div>');d.attr("src",d.attr("zsrc"))})}return false}};var atap={init:function(){$(".atap").on("tap",function(){var a=$(this);a.css({background:"#6FACD5",color:"#FFFFFF","font-weight":"bold","text-decoration":"none","text-shadow":"0 1px 1px #3373A5"});return false});$(".atap a").off("click")}};var POPMENU=new Object;var popup={init:function(){var a=this;$(".popup").each(function(c,d){d=$(d);var b=$(d.attr("href"));if(b&&b.attr("popup")){b.css({display:"none"});d.on("click",function(f){a.open(b)})}});this.maskinit()},maskinit:function(){var a=this;$("#mask").off().on("tap",function(){a.close()})},open:function(a,c,b){this.close();this.maskinit();if(typeof a=="string"){$("#ntcmsg").remove();if(c=="alert"){a='<div class="tip"><dt>'+a+'</dt><dd><input class="button2" type="button" value="确定" onclick="popup.close();"></dd></div>'}else{if(c=="confirm"){a='<div class="tip"><dt>'+a+'</dt><dd><input class="redirect button2" type="button" value="确定" href="'+b+'"><a href="javascript:;" onclick="popup.close();">取消</a></dd></div>'}}$("body").append('<div id="ntcmsg" style="display:none;">'+a+"</div>");a=$("#ntcmsg")}if(POPMENU[a.attr("id")]){$("#"+a.attr("id")+"_popmenu").html(a.html()).css({height:a.height()+"px",width:a.width()+"px"})}else{a.parent().append('<div class="dialogbox" id="'+a.attr("id")+'_popmenu" style="height:'+a.height()+"px;width:"+a.width()+'px;">'+a.html()+"</div>")}var f=$("#"+a.attr("id")+"_popmenu");var e=(window.innerWidth-f.width())/2;var d=(document.documentElement.clientHeight-f.height())/2;f.css({display:"block",position:"fixed",left:e,top:d,"z-index":120,opacity:1});$("#mask").css({display:"block",width:"100%",height:"100%",position:"fixed",top:"0",left:"0",background:"black",opacity:"0.2","z-index":"100"});POPMENU[a.attr("id")]=a},close:function(){$("#mask").css("display","none");$.each(POPMENU,function(a,b){$("#"+a+"_popmenu").css("display","none")})}};var dialog={init:function(){$(document).on("click",".dialog",function(){var a=$(this);popup.open('<img src="template/singcere_xn/src/img/imageloading.gif">');$.ajax({type:"GET",url:a.attr("href")+"&inajax=1",dataType:"xml"}).success(function(b){popup.open(b.lastChild.firstChild.nodeValue);evalscript(b.lastChild.firstChild.nodeValue)}).error(function(){window.location.href=a.attr("href");popup.close()});return false})},};var formdialog={init:function(){$(document).on("click",".formdialog",function(){popup.open('<img src="template/singcere_xn/src/img/imageloading.gif">');var b=$(this);var a=$(this.form);$.ajax({type:"POST",url:a.attr("action")+"&handlekey="+a.attr("id")+"&inajax=1",data:a.serialize(),dataType:"xml"}).success(function(c){popup.open(c.lastChild.firstChild.nodeValue);evalscript(c.lastChild.firstChild.nodeValue)}).error(function(){window.location.href=b.attr("href");popup.close()});return false})}};var redirect={init:function(){$(document).on("click",".redirect",function(){var a=$(this);popup.close();window.location.href=a.attr("href")})}};var DISMENU=new Object;var display={init:function(){var a=this;$(".display").each(function(c,d){d=$(d);var b=$(d.attr("href"));if(b&&b.attr("display")){b.css({display:"none"});b.css({"z-index":"102"});DISMENU[b.attr("id")]=b;d.on("click",function(f){if(in_array(f.target.tagName,["A","IMG","INPUT"])){return}a.maskinit();if(b.attr("display")=="true"){b.css("display","block");b.attr("display","false");$("#mask").css({display:"block",width:"100%",height:"100%",position:"fixed",top:"0",left:"0",background:"transparent","z-index":"100"})}return false})}})},maskinit:function(){var a=this;$("#mask").off().on("touchstart",function(){a.hide()})},hide:function(){$("#mask").css("display","none");$.each(DISMENU,function(a,b){b.css("display","none");b.attr("display","true")})}};var geo={latitude:null,longitude:null,loc:null,errmsg:null,timeout:5000,getcurrentposition:function(){if(!!navigator.geolocation){navigator.geolocation.getCurrentPosition(this.locationsuccess,this.locationerror,{enableHighAcuracy:true,timeout:this.timeout,maximumAge:3000})}},locationerror:function(a){geo.errmsg="error";switch(a.code){case a.TIMEOUT:geo.errmsg="获取位置超时，请重试";break;case a.POSITION_UNAVAILABLE:geo.errmsg="无法检测到您的当前位置";break;case a.PERMISSION_DENIED:geo.errmsg="请允许能够正常访问您的当前位置";break;case a.UNKNOWN_ERROR:geo.errmsg="发生未知错误";break}},locationsuccess:function(a){geo.latitude=a.coords.latitude;geo.longitude=a.coords.longitude;geo.errmsg="";$.ajax({type:"POST",url:"http://maps.google.com/maps/api/geocode/json?latlng="+geo.latitude+","+geo.longitude+"&language=zh-CN&sensor=true",dataType:"json"}).success(function(b){if(b.status=="OK"){geo.loc=b.results[0].formatted_address}}).error(function(){geo.loc=null})}};var pullrefresh={init:function(){var e={};var a=false;var d=null;var c=null;var b=false;$("body").on("touchstart",function(f){f=mygetnativeevent(f);e.startx=f.touches[0].pageX;e.starty=f.touches[0].pageY}).on("touchmove",function(g){g=mygetnativeevent(g);e.curposx=g.touches[0].pageX;e.curposy=g.touches[0].pageY;if(e.curposy-e.starty<0&&!a){return}if(!a&&$(window).scrollTop()<=0){a=true;d=document.createElement("div");d=$(d);d.css({position:"relative","margin-left":"-85px"});$("body").prepend(d);c=document.createElement("div");c=$(c);c.css({position:"absolute",height:"30px",top:"-30px",left:"50%"});c.html('<img src="'+STATICURL+'image/mobile/images/icon_arrow.gif" style="vertical-align:middle;margin-right:5px;-moz-transform:rotate(180deg);-webkit-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg);"><span id="refreshtxt">下拉可以刷新</span>');c.find("img").css({"-webkit-transition":"all 0.5s ease-in-out"});d.prepend(c);e.topx=e.curposx;e.topy=e.curposy}if(!a){return}if(a==true){var f=e.curposy-e.topy;if(f>=0&&f<150){d.css({height:f/2+"px"});c.css({top:(-30+f/2)+"px"});if(b){c.find("img").css({"-webkit-transform":"rotate(180deg)","-moz-transform":"rotate(180deg)","-o-transform":"rotate(180deg)",transform:"rotate(180deg)"});c.find("#refreshtxt").html("下拉可以刷新")}b=false}else{if(f>=150){d.css({height:f/2+"px"});c.css({top:(-30+f/2)+"px"});if(!b){c.find("img").css({"-webkit-transform":"rotate(360deg)","-moz-transform":"rotate(360deg)","-o-transform":"rotate(360deg)",transform:"rotate(360deg)"});c.find("#refreshtxt").html("松开可以刷新")}b=true}}}g.preventDefault()}).on("touchend",function(f){if(a==true){if(b){c.html('<img src="'+STATICURL+'image/mobile/images/icon_load.gif" style="vertical-align:middle;margin-right:5px;">正在加载...');c.animate({top:(-30+75)+"px"},618,"linear");d.animate({height:"75px"},618,"linear",function(){window.location.reload()});return}}d.remove();d=null;a=false;e={}})}};function mygetnativeevent(a){while(a&&typeof a.originalEvent!=="undefined"){a=a.originalEvent}return a}function evalscript(c){if(c.indexOf("<script")==-1){return c}var d=/<script[^\>]*?>([^\x00]*?)<\/script>/ig;var a=[];while(a=d.exec(c)){var e=/<script[^\>]*?src=\"([^\>]*?)\"[^\>]*?(reload=\"1\")?(?:charset=\"([\w\-]+?)\")?><\/script>/i;var b=[];b=e.exec(a[0]);if(b){appendscript(b[1],"",b[2],b[3])}else{e=/<script(.*?)>([^\x00]+?)<\/script>/i;b=e.exec(a[0]);appendscript("",b[2],b[1].indexOf("reload=")!=-1)}}return c}var safescripts={},evalscripts=[];function appendscript(f,d,a,h){var g=hash(f+d);if(!a&&in_array(g,evalscripts)){return}if(a&&$("#"+g)[0]){$("#"+g)[0].parentNode.removeChild($("#"+g)[0])}evalscripts.push(g);var b=document.createElement("script");b.type="text/javascript";b.id=g;b.charset=h?h:(!document.charset?document.characterSet:document.charset);try{if(f){b.src=f;b.onloadDone=false;b.onload=function(){b.onloadDone=true;JSLOADED[f]=1};b.onreadystatechange=function(){if((b.readyState=="loaded"||b.readyState=="complete")&&!b.onloadDone){b.onloadDone=true;JSLOADED[f]=1}}}else{if(d){b.text=d}}document.getElementsByTagName("head")[0].appendChild(b)}catch(c){}}function hash(c,a){var a=a?a:32;var e=0;var b=0;var d="";filllen=a-c.length%a;for(b=0;b<filllen;b++){c+="0"}while(e<c.length){d=stringxor(d,c.substr(e,a));e+=a}return d}function stringxor(e,c){var f="";var g="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";var a=Math.max(e.length,c.length);for(var d=0;d<a;d++){var b=e.charCodeAt(d)^c.charCodeAt(d);f+=g.charAt(b%52)}return f}function in_array(c,b){if(typeof c=="string"||typeof c=="number"){for(var a in b){if(b[a]==c){return true}}}return false}function isUndefined(a){return typeof a=="undefined"?true:false}function setcookie(d,f,e,c,a,g){if(f==""||e<0){f="";e=-2592000}if(e){var b=new Date();b.setTime(b.getTime()+e*1000)}a=!a?cookiedomain:a;c=!c?cookiepath:c;document.cookie=escape(cookiepre+d)+"="+escape(f)+(b?"; expires="+b.toGMTString():"")+(c?"; path="+c:"/")+(a?"; domain="+a:"")+(g?"; secure":"")}function getcookie(c,a){c=cookiepre+c;var e=document.cookie.indexOf(c);var d=document.cookie.indexOf(";",e);if(e==-1){return""}else{var b=document.cookie.substring(e+c.length+1,(d>e?d:document.cookie.length));return!a?unescape(b):b}}$(document).ready(function(){if($("div.pg").length>0){page.converthtml()}if($("img").length>0){img.init(1)}if($(".popup").length>0){popup.init()}if($(".display").length>0){display.init()}if($(".atap").length>0){atap.init()}if($(".pullrefresh").length>0){pullrefresh.init()}dialog.init();formdialog.init();redirect.init()});

